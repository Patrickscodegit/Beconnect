{
  "version": "1.0",
  "description": "Field mapping configuration for Robaws integration",
  "field_mappings": {
    "quotation_info": {
      "customer": {
        "sources": ["contact.name", "contact_info.name", "email_metadata.from", "document_data.contact.name", "intake.customer_name"],
        "default": "Unknown Customer"
      },
      "customer_reference": {
        "sources": [
          "customer_reference",
          "document_data.customer_reference",
          "email_metadata.subject",
          "concerning",
          "title",
          "description"
        ],
        "fallback_template": "EXP RORO - {origin_country} - {pol_code} - {destination_city} - {cargo_desc}",
        "components": {
          "origin_country": {
            "sources": ["raw_data.transport_details.origin.pickup_address", "raw_data.transport_details.origin.pickup_location", "raw_data.transport_details.origin.address", "raw_data.transport_details.origin.location", "raw_data.request.origin.pickup_address", "raw_data.request.origin.pickup_location", "raw_data.request.origin.address", "raw_data.request.origin.location", "raw_data.expedition.origin", "raw_data.request.origin.country", "raw_data.transport_details.origin.country", "raw_data.origin"],
            "transform": "normalize_city"
          },
          "pol_code": {
            "sources": ["raw_data.expedition.pol", "raw_data.request.origin.country", "raw_data.transport_details.origin.country", "raw_data.origin"],
            "transform": "city_to_port",
            "default": "ANR"
          },
          "destination_city": {
            "sources": ["raw_data.expedition.destination", "raw_data.request.destination.city", "raw_data.request.destination.country", "raw_data.transport_details.destination.city", "raw_data.transport_details.destination.country", "raw_data.destination"],
            "transform": "normalize_city"
          },
          "cargo_desc": {
            "sources": ["raw_data.expedition.vehicle.make", "raw_data.expedition.vehicle.model", "raw_data.request.cargo.type", "raw_data.request.cargo.quantity", "raw_data.transport_details.cargo.description", "raw_data.transport_details.cargo.quantity", "raw_data.vehicle_make", "raw_data.vehicle_model", "raw_data.cargo_description", "raw_data.quantity"],
            "transform": "format_simple_cargo"
          }
        },
        "default": null
      },
      "endcustomer": {
        "sources": ["contact.name", "contact_info.name"],
        "default": null
      },
      "contact": {
        "sources": ["contact.phone", "contact_info.phone_number", "contact.phone_number", "contact_phone", "intake.contact_phone"],
        "default": null
      },
      "client_email": {
        "sources": ["contact.email", "contact_info.email", "email", "document_data.contact.email", "intake.contact_email"],
        "default": null,
        "validate": "email"
      },
      "concerning": {
        "sources": ["raw_data.transport_details.cargo.description","raw_data.transport_details.type","raw_data.transport_details.mode"],
        "default": null
      },
      "winst": {
        "sources": ["raw_data.transport_details.cargo.description","raw_data.transport_details.type"],
        "default": null
      }
    },
    "routing": {
      "por": {
        "transform": "normalize_city",
        "sources": ["raw_data.transport_details.origin.pickup_address","raw_data.transport_details.origin.pickup_location","raw_data.transport_details.origin.address","raw_data.transport_details.origin.location","raw_data.request.origin.pickup_address","raw_data.request.origin.pickup_location","raw_data.request.origin.address","raw_data.request.origin.location","origin","shipment.origin","routing.origin","transport.from","document_data.shipment.origin","document_data.routing.por","raw_data.expedition.origin","raw_data.request.origin.country","raw_data.transport_details.origin.country","raw_data.origin"],
        "fallback": "extract_from_messages",
        "default": null
      },
      "pol": {
        "sources": ["raw_data.transport_details.origin.pickup_address", "raw_data.transport_details.origin.pickup_location", "raw_data.transport_details.origin.address", "raw_data.transport_details.origin.location", "raw_data.request.origin.pickup_address", "raw_data.request.origin.pickup_location", "raw_data.request.origin.address", "raw_data.request.origin.location", "origin","shipment.origin","routing.origin","document_data.shipment.origin","document_data.routing.pol","por","raw_data.expedition.origin","raw_data.transport_details.origin.country","raw_data.origin"],
        "transform": "city_to_port",
        "default": "Los Angeles"
      },
      "pod": {
        "transform": "normalize_city",
        "sources": ["destination","shipment.destination","routing.destination","transport.to","document_data.shipment.destination","document_data.routing.pod","raw_data.expedition.destination","raw_data.request.destination.city","raw_data.request.destination.country","raw_data.transport_details.destination.city","raw_data.transport_details.destination.country","raw_data.destination"],
        "fallback": "extract_from_messages",
        "default": null
      },
      "pot": {
        "sources": ["shipment.transshipment","routing.via","document_data.routing.pot","raw_data.transport_details.transshipment"],
        "default": null
      },
      "fdest": {
        "sources": ["shipment.final_destination","raw_data.request.destination.final_destination.region","raw_data.request.destination.final_destination.country","raw_data.transport_details.destination.final_destination"],
        "default": null
      },
      "in_transit_to": {
        "sources": ["raw_data.transport_details.destination.final_destination","raw_data.transport_details.destination.city"],
        "default": null
      }
    },
    "cargo_details": {
      "cargo": {
        "sources": ["raw_data.expedition.vehicle.make", "raw_data.expedition.vehicle.model", "raw_data.request.cargo.type", "raw_data.request.cargo.quantity", "raw_data.transport_details.cargo.description", "raw_data.transport_details.cargo.quantity", "raw_data.vehicle_make", "raw_data.vehicle_model", "raw_data.cargo_description", "raw_data.quantity"],
        "transform": "format_simple_cargo",
        "default": null
      },
      "dim_bef_delivery": {
        "transform": "format_dimensions",
        "sources": [
          "dimensions",
          "vehicle.dimensions_formatted",
          "cargo.dimensions",
          "shipment.dimensions",
          "document_data.vehicle.dimensions",
          "document_data.vehicle.dimensions_m",
          "raw_data.request.cargo.dimensions",
          "raw_data.transport_details.cargo.dimensions",
          "raw_data.vehicle_make",
          "raw_data.vehicle_model",
          "raw_data.vehicle_year"
        ],
        "default": null
      },
      "weight_kg": {
        "sources": [
          "weight_numeric",
          "weight",
          "vehicle.weight_kg", 
          "vehicle_details.weight", 
          "vehicle.weight",
          "cargo.weight"
        ],
        "transform": "extract_weight_numeric"
      },
      "container_nr": {
        "sources": ["raw_data.transport_details.container_type","raw_data.transport_details.mode"],
        "default": "RoRo"
      }
    },
    "vehicle_details": {
      "vehicle_brand": {
        "sources": ["vehicle_make", "vehicle.brand", "vehicle.make", "vehicle_details.brand", "document_data.vehicle.brand"],
        "default": null
      },
      "vehicle_model": {
        "sources": ["vehicle_model", "vehicle.model", "vehicle_details.model", "vehicle.full_name", "document_data.vehicle.model"],
        "transform": "clean_vehicle_model",
        "default": null
      },
      "vehicle_year": {
        "sources": ["vehicle_year", "vehicle.year", "vehicle_details.year", "vehicle.model_year", "document_data.vehicle.year"],
        "transform": "to_integer"
      },
      "vehicle_color": {
        "sources": ["vehicle.color", "vehicle_details.color", "vehicle.colour", "document_data.vehicle.color"],
        "default": null
      },
      "vehicle_condition": {
        "sources": ["vehicle_condition", "vehicle.condition", "vehicle_details.condition", "vehicle.status", "document_data.vehicle.condition"],
        "default": "Used"
      },
      "vehicle_vin": {
        "sources": ["vehicle.vin", "vehicle_details.vin", "vehicle.chassis_number", "document_data.vehicle.vin"],
        "default": null
      },
      "engine_cc": {
        "sources": [
          "engine_cc",
          "engine_size",
          "vehicle.engine_cc", 
          "vehicle_details.engine_cc",
          "vehicle.engine",
          "vehicle.engine_size"
        ],
        "transform": "extract_engine_cc"
      },
      "fuel_type": {
        "sources": [
          "fuel_type",
          "vehicle.fuel_type", 
          "vehicle_details.fuel",
          "vehicle.engine_type"
        ],
        "transform": "standardize_fuel_type"
      },
      "vehicle_length": {
        "sources": ["length","vehicle.length","vehicle.dimensions.length","vehicle_details.length","document_data.vehicle.dimensions.length_m"],
        "transform": "to_meters"
      },
      "vehicle_width": {
        "sources": ["width","vehicle.width","vehicle.dimensions.width","vehicle_details.width","document_data.vehicle.dimensions.width_m"],
        "transform": "to_meters"
      },
      "vehicle_height": {
        "sources": ["height","vehicle.height","vehicle.dimensions.height","vehicle_details.height","document_data.vehicle.dimensions.height_m"],
        "transform": "to_meters"
      }
    },
    "dates": {
      "pickup_date": {
        "sources": ["dates.pickup_date", "shipment.pickup_date"],
        "transform": "to_date"
      },
      "delivery_date": {
        "sources": ["dates.delivery_date", "shipment.delivery_date"],
        "transform": "to_date"
      },
      "departure_date": {
        "sources": ["dates.departure_date", "shipment.departure_date"],
        "transform": "to_date"
      },
      "arrival_date": {
        "sources": ["dates.arrival_date", "shipment.arrival_date"],
        "transform": "to_date"
      }
    },
    "trade_terms": {
      "incoterms": {
        "sources": ["incoterms", "trade_terms.incoterms"],
        "default": "CIF"
      },
      "payment_terms": {
        "sources": ["payment_terms", "trade_terms.payment"],
        "default": null
      }
    },
    "metadata": {
      "email_subject": {
        "sources": ["email_metadata.subject"],
        "default": null
      },
      "email_from": {
        "sources": ["email_metadata.from"],
        "default": null
      },
      "email_to": {
        "sources": ["email_metadata.to"],
        "default": null
      },
      "email_date": {
        "sources": ["email_metadata.date"],
        "transform": "to_date"
      },
      "internal_remarks": {
        "sources": ["messages"],
        "transform": "format_messages"
      },
      "special_requirements": {
        "sources": ["special_requirements", "special_instructions"],
        "default": null
      },
      "reference_number": {
        "sources": ["reference_number", "invoice_number"],
        "default": null
      }
    },
    "service_type": {
      "freight_type": {
        "default": "RoRo Vehicle Transport"
      },
      "shipment_type": {
        "default": "RoRo"
      },
      "container_type": {
        "default": "RoRo"
      },
      "container_quantity": {
        "default": 1,
        "transform": "to_integer"
      }
    }
  },
  "transformations": {
    "city_to_port": {
      "Brussels": "Antwerp",
      "Bruxelles": "Antwerp",
      "Brussels, Belgium": "Antwerp",
      "Bruxelles, Belgique": "Antwerp",
      "Paris": "Le Havre",
      "Frankfurt": "Hamburg",
      "Munich": "Hamburg",
      "Milano": "Genoa",
      "Madrid": "Valencia",
      "Barcelona": "Barcelona",
      "Amsterdam": "Rotterdam",
      "London": "Portsmouth",
      "Dover": "Dover"
    },
    "city_to_code": {
      "Brussels": "BRU",
      "Bruxelles": "BRU",
      "Jeddah": "JED",
      "Djeddah": "JED",
      "Brussels, Belgium": "BRU",
      "Bruxelles, Belgique": "BRU",
      "Bruxelles, Belgium": "BRU",
      "Antwerp, Belgium": "ANR",
      "Jeddah, Saudi Arabia": "JED",
      "Djeddah, Arabie Saoudite": "JED",
      "Djeddah, Saudi Arabia": "JED",
      "Dubai, UAE": "DXB",
      "Rotterdam, Netherlands": "RTM",
      "Hamburg, Germany": "HAM",
      "Le Havre, France": "LEH",
      "Portsmouth, UK": "POR",
      "Dover, UK": "DOV"
    }
  },
    "validation_rules": {
      "email": {
        "type": "regex",
        "pattern": "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
      },
      "numeric": {
        "type": "numeric",
        "min": 0
      },
      "date": {
        "type": "date",
        "format": "Y-m-d"
      }
    },
    "raw_data_fields": {
      "json_data": {
        "sources": ["JSON", "raw_json", "extraction_json"],
        "target": "JSON",
        "format": "json_preserve",
        "description": "Complete extraction data for Robaws JSON tab"
      },
      "extraction_metadata": {
        "sources": ["extraction_method", "extraction_timestamp"],
        "target": "extraction_info",
        "format": "json"
      },
      "enhancement_data": {
        "sources": ["data_attribution", "enhancement_confidence"],
        "target": "enhancement_metadata",
        "format": "json"
      }
    },
    "enhanced_vehicle_fields": {
      "dimensions": {
        "sources": ["dimensions", "vehicle_dimensions"],
        "target": "DIM_REF_DELIVE",
        "description": "Vehicle dimensions for cargo calculation"
      },
      "weight": {
        "sources": ["weight", "vehicle_weight", "weight_numeric"],
        "target": "WEIGHT",
        "description": "Vehicle weight information"
      },
      "cargo_volume": {
        "sources": ["cargo_volume", "calculated_volume"],
        "target": "CARGO_VOLUME",
        "description": "Calculated cargo volume"
      },
      "container_recommendation": {
        "sources": ["recommended_container", "typical_container"],
        "target": "CONTAINER_NR",
        "description": "Recommended container type"
      },
      "shipping_class": {
        "sources": ["shipping_class", "weight_class"],
        "target": "SHIPPING_CLASS",
        "description": "Shipping weight classification"
      }
    }
  }